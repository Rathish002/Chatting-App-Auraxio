import { BundleOptions, File, PackagerContext } from 'packager';

type ApplicationCache = {
  get: (name: string) => any | undefined;
  getAll: () => { [name: string]: any };
  set: (name: string, value: any) => boolean;
  has: (name: string) => boolean;
  update: (name: string, value: any) => boolean;
  delete: (name: string) => boolean;
  clear: () => void;
};

type ParsedPackagePath = {
  name: string | null;
  version: string | null;
  path: string | null;
};

type ModifiedFile = {
  code: string;
  path: string;
};

type VerifyExtensions = (
  path: string,
  ignoreExternal?: boolean
) => boolean;

type PathUtil = {
  isAbsolute: (path: string) => boolean;
  isRelative: (path: string) => boolean;
  basename: (path: string) => string | undefined;
  dirname: (path: string) => string;
  extname: (path: string) => string;
  relative: (from: string, to: string) => string;
  resolve: (...paths: string[]) => string;
  normalize: (path: string) => string;
  sep: string;
};

type DeepMergeArrayValue = string[];
type DeepMergeObjectValue = { [key: string]: any };
declare function deepMerge(
  ...sources: DeepMergeArrayValue[]
): DeepMergeArrayValue;
declare function deepMerge(
  ...sources: DeepMergeObjectValue[]
): DeepMergeObjectValue;

const cacheFactory: () => ApplicationCache;
const isModuleExternal: (modulePath: string) => boolean;
const normalizeBundleOptions: (
  BundleOptions: BundleOptions
) => BundleOptions;
const parsePackagePath: (name: string) => ParsedPackagePath;
const path: PathUtil;
const stylePluginHelpers: {
  generateExport: (
    file: File | ModifiedFile,
    prependExportDefault?: boolean
  ) => string;
  generateExportsForAllStyles: (styles: string[], filePath: string) => string;
};
const verifyExtensions: (extensions: string[]) => VerifyExtensions;
const resolveRelative: (
  childPath: string,
  parentPath: string,
  context: PackagerContext,
  pathOnly?: boolean
) => File | string | null;
const resolveRelativeExternal: (
  childPath: string,
  parentPath: string,
  context: PackagerContext
) => string | null | never;

const generateSourceMap: (
  filePath: string,
  originalCode: string,
  generatedCode: string
) => string;

export { ApplicationCache, DeepMergeArrayValue, DeepMergeObjectValue, ModifiedFile, ParsedPackagePath, PathUtil, VerifyExtensions, cacheFactory, deepMerge, generateSourceMap, isModuleExternal, normalizeBundleOptions, parsePackagePath, path, resolveRelative, resolveRelativeExternal, stylePluginHelpers, verifyExtensions };
